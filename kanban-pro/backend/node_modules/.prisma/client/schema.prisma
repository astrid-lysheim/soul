// Kanban Pro - Database Schema
// PostgreSQL + Prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Board {
  id        String   @id @default(cuid())
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  columns Column[]
  labels  Label[]

  @@map("boards")
}

model Column {
  id        String   @id @default(cuid())
  boardId   String
  name      String
  position  Int
  color     String? // Optional column color
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  board Board  @relation(fields: [boardId], references: [id], onDelete: Cascade)
  cards Card[]

  @@index([boardId])
  @@map("columns")
}

model Card {
  id          String    @id @default(cuid())
  columnId    String
  title       String
  description String? // Markdown content
  position    Int
  dueDate     DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  column         Column          @relation(fields: [columnId], references: [id], onDelete: Cascade)
  labels         CardLabel[]
  checklistItems ChecklistItem[]

  @@index([columnId])
  @@index([dueDate])
  @@map("cards")
}

model Label {
  id        String   @id @default(cuid())
  boardId   String
  name      String
  color     String // Hex color code
  createdAt DateTime @default(now())

  board Board       @relation(fields: [boardId], references: [id], onDelete: Cascade)
  cards CardLabel[]

  @@index([boardId])
  @@map("labels")
}

model CardLabel {
  cardId  String
  labelId String

  card  Card  @relation(fields: [cardId], references: [id], onDelete: Cascade)
  label Label @relation(fields: [labelId], references: [id], onDelete: Cascade)

  @@id([cardId, labelId])
  @@map("card_labels")
}

model ChecklistItem {
  id        String   @id @default(cuid())
  cardId    String
  text      String
  completed Boolean  @default(false)
  position  Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  card Card @relation(fields: [cardId], references: [id], onDelete: Cascade)

  @@index([cardId])
  @@map("checklist_items")
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HABITS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model Habit {
  id        String   @id @default(cuid())
  icon      String   @default("ğŸ“Œ")
  name      String
  freq      String // 'daily', 'weekdays', 'custom'
  days      String // JSON array of day indices [0-6], Mon=0
  position  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  logs HabitLog[]

  @@map("habits")
}

model HabitLog {
  id        String   @id @default(cuid())
  habitId   String
  date      String // YYYY-MM-DD
  completed Boolean  @default(true)
  createdAt DateTime @default(now())

  habit Habit @relation(fields: [habitId], references: [id], onDelete: Cascade)

  @@unique([habitId, date])
  @@index([habitId])
  @@index([date])
  @@map("habit_logs")
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCHEDULE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model ScheduleBlock {
  id        String   @id @default(cuid())
  title     String
  day       Int // 0-6, Mon=0
  startTime String // "HH:MM" format
  duration  Float // hours (e.g., 1.5)
  color     String   @default("blue")
  repeat    String   @default("none") // 'none' or 'weekly'
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("schedule_blocks")
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STUDY PLAN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model StudyPhase {
  id          String   @id @default(cuid())
  icon        String
  name        String
  description String?
  position    Int
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  weeks StudyWeek[]

  @@map("study_phases")
}

model StudyWeek {
  id        String   @id @default(cuid())
  phaseId   String
  title     String
  source    String? // e.g., "Textbook Ch. 3"
  position  Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  phase  StudyPhase   @relation(fields: [phaseId], references: [id], onDelete: Cascade)
  topics StudyTopic[]

  @@index([phaseId])
  @@map("study_weeks")
}

model StudyTopic {
  id        String   @id @default(cuid())
  weekId    String
  text      String
  examTag   Boolean  @default(false) // Flag for "likely on exam"
  completed Boolean  @default(false)
  position  Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  week StudyWeek @relation(fields: [weekId], references: [id], onDelete: Cascade)

  @@index([weekId])
  @@map("study_topics")
}
