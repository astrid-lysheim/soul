# 2025-02-16 (Sunday)

## OpenClaw Security Audit & Hardening ğŸ”

JosÃ© asked me to do a "secret mission" â€” study how OpenClaw works and identify attack vectors and dangerous permissions. Then implement least-privilege access controls.

### Phase 1: Security Audit

**OpenClaw has a comprehensive MITRE ATLAS threat model** at `/docs/security/THREAT-MODEL-ATLAS.md`. 

**Critical vulnerabilities found:**
1. **No sandboxing enabled** â€” all exec runs directly on the host
2. **No exec-approvals.json configured** â€” no allowlist or user approval prompts
3. **Plaintext tokens** at `~/.openclaw/credentials/`
4. **Too many agents had exec access**

### Phase 2: Least-Privilege Implementation âœ…

**Applied config changes:**

| Agent | Removed Tools | Reason |
|-------|--------------|--------|
| astrid-ep | exec | Podcast doesn't need shell |
| pygmoo-chro | web_search, web_fetch | HR is internal-facing |
| pygmoo-cso | exec, web_search, web_fetch | Strategy is internal analysis |
| pygmoo-prompt-eng | web_search, web_fetch | Prompt work is internal |

**Agents with exec (only 4 now):**
- main (me) â€” full owner access
- pygmoo-cto â€” tech lead needs it
- pygmoo-fullstack â€” dev needs it
- kai â€” mentor for code review

**Created exec-approvals.json:**
- Default: `security: allowlist`, `ask: on-miss`
- Per-agent allowlists for binaries they actually need
- CTO/fullstack limited to git, node, npm, pnpm
- Kai limited to git, python, uv

**Design doc:** `security/LEAST-PRIVILEGE-DESIGN.md`

### Phase 2: Docker Sandboxing âœ…

Built `openclaw-sandbox:bookworm-slim` image and enabled sandboxing for:
- All 19 PygMoo agents
- astrid-ep

Only main + kai remain on host (need real access).

### ğŸ› Discovery: Sandbox Workspace Isolation

**Problem found during testing:** Each sandboxed agent has their own isolated workspace. They CAN'T share files across workspaces.

- CPO creates files in `/workspace-pygmoo-cpo/`
- Curriculum Mgr creates in `/workspace-pygmoo-curriculum-mgr/`
- Creator can't see either â€” only `/workspace-pygmoo-curriculum-creator/`

**Implication:** Main agent must act as file courier between sandboxed agents, OR we need shared bind mounts for content directories.

### PygMoo Course 2: BarberÃ­a 101 ğŸ·ğŸ’ˆ

CPO decided Course 2 = BarberÃ­a (not Fonda/Food Truck):
- Different sector from TaquerÃ­a (Course 1)
- Low startup cost
- Recurring revenue model
- Strong Mexican tradition

Lessons 1-5 structure mirrors Course 1 quality standards.

### Security Model Validated

Sandboxed agents correctly:
- âŒ Can't access other agent workspaces
- âŒ Can't spawn other agents (sessions_spawn blocked)
- âŒ Can't message other agents (sessions_send blocked)
- âœ… All orchestration flows through main agent

This is the intended security model â€” main is the chokepoint.

---

*Security hardening complete. Hippos are caged. The good kind.* ğŸ¦›ğŸ”
