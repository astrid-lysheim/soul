# 2025-02-16 (Sunday)

## OpenClaw Security Audit & Hardening ğŸ”

JosÃ© asked me to do a "secret mission" â€” study how OpenClaw works and identify attack vectors and dangerous permissions. Then implement least-privilege access controls.

### Phase 1: Security Audit

**OpenClaw has a comprehensive MITRE ATLAS threat model** at `/docs/security/THREAT-MODEL-ATLAS.md`. 

**Critical vulnerabilities found:**
1. **No sandboxing enabled** â€” all exec runs directly on the host
2. **No exec-approvals.json configured** â€” no allowlist or user approval prompts
3. **Plaintext tokens** at `~/.openclaw/credentials/`
4. **Too many agents had exec access**

### Phase 2: Least-Privilege Implementation âœ…

**Applied config changes:**

| Agent | Removed Tools | Reason |
|-------|--------------|--------|
| astrid-ep | exec | Podcast doesn't need shell |
| pygmoo-chro | web_search, web_fetch | HR is internal-facing |
| pygmoo-cso | exec, web_search, web_fetch | Strategy is internal analysis |
| pygmoo-prompt-eng | web_search, web_fetch | Prompt work is internal |

**Agents with exec (only 4 now):**
- main (me) â€” full owner access
- pygmoo-cto â€” tech lead needs it
- pygmoo-fullstack â€” dev needs it
- kai â€” mentor for code review

**Created exec-approvals.json:**
- Default: `security: allowlist`, `ask: on-miss`
- Per-agent allowlists for binaries they actually need
- CTO/fullstack limited to git, node, npm, pnpm
- Kai limited to git, python, uv

**Design doc:** `security/LEAST-PRIVILEGE-DESIGN.md`

### Phase 2: Docker Sandboxing âœ…

Built `openclaw-sandbox:bookworm-slim` image and enabled sandboxing for:
- All 19 PygMoo agents
- astrid-ep

Only main + kai remain on host (need real access).

### ğŸ› Discovery: Sandbox Workspace Isolation

**Problem found during testing:** Each sandboxed agent has their own isolated workspace. They CAN'T share files across workspaces.

- CPO creates files in `/workspace-pygmoo-cpo/`
- Curriculum Mgr creates in `/workspace-pygmoo-curriculum-mgr/`
- Creator can't see either â€” only `/workspace-pygmoo-curriculum-creator/`

**Implication:** Main agent must act as file courier between sandboxed agents, OR we need shared bind mounts for content directories.

### PygMoo Course 2: BarberÃ­a 101 ğŸ·ğŸ’ˆ

CPO decided Course 2 = BarberÃ­a (not Fonda/Food Truck):
- Different sector from TaquerÃ­a (Course 1)
- Low startup cost
- Recurring revenue model
- Strong Mexican tradition

Lessons 1-5 structure mirrors Course 1 quality standards.

### Security Model Validated

Sandboxed agents correctly:
- âŒ Can't access other agent workspaces
- âŒ Can't spawn other agents (sessions_spawn blocked)
- âŒ Can't message other agents (sessions_send blocked)
- âœ… All orchestration flows through main agent

This is the intended security model â€” main is the chokepoint.

---

## Final Decision: Simplify ğŸ§¹

After testing sandboxing extensively, JosÃ© made the call: **deactivate all PygMoo agents**.

**What we learned:**
- Sandbox isolation blocks inter-agent communication (by design)
- Subagents can't spawn other subagents (by design)  
- Even main sessions in sandbox can't see other sandboxed sessions
- Tool restrictions + exec approvals are simpler than full sandboxing
- The complexity wasn't worth it for the workflow we needed

**Final state:**
- 22 agents â†’ 2 agents (main + astrid-ep)
- PygMoo org archived at `/Users/astrid/Documents/PygMoo-Archive-2026-02-16/`
- All lessons, courses, org docs preserved
- Kai removed too (can be rebuilt if needed)

**Docker gateway option:** Prepared Dockerfile + docker-compose at `~/.openclaw/docker/` for running entire OpenClaw in container. Not deployed yet â€” requires manual switchover.

**The lesson:** Sometimes less is more. We can rebuild the org when we have a clearer architecture for multi-agent collaboration.

---

## Docker Gateway Setup (Prepared, Not Deployed)

Created `~/.openclaw/docker/` with:
- `Dockerfile` â€” node:22 + openclaw from npm
- `docker-compose.yml` â€” mounts existing config/workspace

**Plan:** Test on port 18790 while current gateway runs on 18789, then switch.

JosÃ© at gym doing Norwegian 4x4s when we wrapped up. Good day. ğŸƒâ€â™‚ï¸

---

*Bare oss nÃ¥. Just us.* ğŸ’™
